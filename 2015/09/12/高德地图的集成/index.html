<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>集成高德地图 | AlexChenZhaoShen的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="高德地1.0 注册高德地图开放平台开发者账号2.0 创建新应用,填写信息,获取Key名称和Key
3.0 开发环境配置(CocoaPods)123pod &amp;apos;AMap3DMap&amp;apos; #3D地图SDKpod &amp;apos;AMap2DMap&amp;apos; #2D地图SDK(2D地图和3D地图不能同时使用)pod &amp;apos;AMapSearch&amp;apos; #搜索服务SDK
4.0 简单">
<meta property="og:type" content="article">
<meta property="og:title" content="集成高德地图">
<meta property="og:url" content="http://yoursite.com/2015/09/12/高德地图的集成/index.html">
<meta property="og:site_name" content="AlexChenZhaoShen的博客">
<meta property="og:description" content="高德地1.0 注册高德地图开放平台开发者账号2.0 创建新应用,填写信息,获取Key名称和Key
3.0 开发环境配置(CocoaPods)123pod &amp;apos;AMap3DMap&amp;apos; #3D地图SDKpod &amp;apos;AMap2DMap&amp;apos; #2D地图SDK(2D地图和3D地图不能同时使用)pod &amp;apos;AMapSearch&amp;apos; #搜索服务SDK
4.0 简单">
<meta property="og:image" content="http://7xsg53.com1.z0.glb.clouddn.com/image/Alex/Snip20160330_1.png">
<meta property="og:image" content="http://cache.amap.com/lbs/static/backgroundlocation.png">
<meta property="og:image" content="http://cache.amap.com/lbs/static/restaurantannotation-e1417594095862.png">
<meta property="og:image" content="http://cache.amap.com/lbs/static/callout.png">
<meta property="og:updated_time" content="2016-04-02T14:12:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="集成高德地图">
<meta name="twitter:description" content="高德地1.0 注册高德地图开放平台开发者账号2.0 创建新应用,填写信息,获取Key名称和Key
3.0 开发环境配置(CocoaPods)123pod &amp;apos;AMap3DMap&amp;apos; #3D地图SDKpod &amp;apos;AMap2DMap&amp;apos; #2D地图SDK(2D地图和3D地图不能同时使用)pod &amp;apos;AMapSearch&amp;apos; #搜索服务SDK
4.0 简单">
<meta name="twitter:image" content="http://7xsg53.com1.z0.glb.clouddn.com/image/Alex/Snip20160330_1.png">
  
    <link rel="alternative" href="/atom.xml" title="AlexChenZhaoShen的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://p2.gexing.com/touxiang/20120727/1637/5012536600562_200x200_3.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">AlexCzs</a></h1>
		</hgroup>

		
		<p class="header-subtitle">你可以比过去的自己优秀,但是你不能比我优秀</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>About</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/AlexCzs" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/2121641485/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/GitHub-pages-Jekyll-markdown-layouts/" style="font-size: 10px;">GitHub, pages, Jekyll, markdown, layouts</a> <a href="/tags/Jekyll/" style="font-size: 10px;">Jekyll</a> <a href="/tags/test/" style="font-size: 10px;">test</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">AlexCzs</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://p2.gexing.com/touxiang/20120727/1637/5012536600562_200x200_3.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">AlexCzs</h1>
			</hgroup>
			
			<p class="header-subtitle">你可以比过去的自己优秀,但是你不能比我优秀</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/AlexCzs" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/2121641485/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-高德地图的集成" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/09/12/高德地图的集成/" class="article-date">
  	<time datetime="2015-09-11T16:00:00.000Z" itemprop="datePublished">2015-09-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      集成高德地图
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="高德地"><a href="#高德地" class="headerlink" title="高德地"></a>高德地</h1><h3 id="1-0-注册高德地图开放平台开发者账号"><a href="#1-0-注册高德地图开放平台开发者账号" class="headerlink" title="1.0 注册高德地图开放平台开发者账号"></a>1.0 注册高德地图开放平台开发者账号</h3><h3 id="2-0-创建新应用-填写信息-获取Key名称和Key"><a href="#2-0-创建新应用-填写信息-获取Key名称和Key" class="headerlink" title="2.0 创建新应用,填写信息,获取Key名称和Key"></a>2.0 创建新应用,填写信息,获取Key名称和Key</h3><p><img src="http://7xsg53.com1.z0.glb.clouddn.com/image/Alex/Snip20160330_1.png" alt="Mou icon"></p>
<h3 id="3-0-开发环境配置-CocoaPods"><a href="#3-0-开发环境配置-CocoaPods" class="headerlink" title="3.0 开发环境配置(CocoaPods)"></a>3.0 开发环境配置(CocoaPods)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;AMap3DMap&apos; #3D地图SDK</span><br><span class="line">pod &apos;AMap2DMap&apos; #2D地图SDK(2D地图和3D地图不能同时使用)</span><br><span class="line">pod &apos;AMapSearch&apos; #搜索服务SDK</span><br></pre></td></tr></table></figure>
<h3 id="4-0-简单集成高德地图"><a href="#4-0-简单集成高德地图" class="headerlink" title="4.0 简单集成高德地图"></a>4.0 简单集成高德地图</h3><h4 id="4-1-iOS9-0-需要配置ATS"><a href="#4-1-iOS9-0-需要配置ATS" class="headerlink" title="4.1 iOS9.0 需要配置ATS"></a>4.1 iOS9.0 需要配置ATS</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</span><br><span class="line">    &lt;true/&gt;</span><br><span class="line">&lt;/dict&gt;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-iOS9-0-如要调起高德地图App-必须配置白名单"><a href="#4-2-iOS9-0-如要调起高德地图App-必须配置白名单" class="headerlink" title="4.2 iOS9.0 如要调起高德地图App,必须配置白名单"></a>4.2 iOS9.0 如要调起高德地图App,必须配置白名单</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;LSApplicationQueriesSchemes&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">    &lt;string&gt;iosamap&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-显示地图"><a href="#4-3-显示地图" class="headerlink" title="4.3 显示地图"></a>4.3 显示地图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;ViewController.h&gt;</span><br><span class="line">#import &lt;MAMapKit/MAMapKit.h&gt;</span><br><span class="line"> </span><br><span class="line">@interface ViewController ()&lt;MAMapViewDelegate&gt;</span><br><span class="line">&#123;</span><br><span class="line">    MAMapView *_mapView;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="4-4-在ViewController-m文件相应的方法中进行地图初始化-3D矢量地图"><a href="#4-4-在ViewController-m文件相应的方法中进行地图初始化-3D矢量地图" class="headerlink" title="4.4 在ViewController.m文件相应的方法中进行地图初始化(3D矢量地图)"></a>4.4 在ViewController.m文件相应的方法中进行地图初始化(3D矢量地图)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-(void) viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    // Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">    //配置用户Key</span><br><span class="line">    [MAMapServices sharedServices].apiKey = @&quot;用户Key&quot;;</span><br><span class="line"> </span><br><span class="line">    _mapView = [[MAMapView alloc] initWithFrame:CGRectMake(0, 0, CGRectGetWidth(self.view.bounds), CGRectGetHeight(self.view.bounds))];</span><br><span class="line">    // 设置代理</span><br><span class="line">    _mapView.delegate = self;</span><br><span class="line">     </span><br><span class="line">    [self.view addSubview:_mapView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-附加配置"><a href="#4-5-附加配置" class="headerlink" title="4.5 附加配置"></a>4.5 附加配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 隐藏标注</span><br><span class="line">_mapView.showsLabel = NO;</span><br><span class="line">// 设置语言为英语</span><br><span class="line">_mapView.language = MAMapLanguageEn;</span><br></pre></td></tr></table></figure>
<h3 id="5-0-地图定位"><a href="#5-0-地图定位" class="headerlink" title="5.0 地图定位"></a>5.0 地图定位</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">需在info.plist添加NSLocationWhenInUseUsageDescription或NSLocationAlwaysUsageDescription字段</span><br><span class="line"></span><br><span class="line">NSLocationWhenInUseUsageDescription:表示应用在前台的时候可以搜到更新的位置信息。</span><br><span class="line">NSLocationAlwaysUsageDescription:表示应用在前台和后台（suspend或terminated)都可以获取到更新的位置数据。</span><br></pre></td></tr></table></figure>
<h4 id="5-1-开起定位"><a href="#5-1-开起定位" class="headerlink" title="5.1 开起定位"></a>5.1 开起定位</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_mapView.showsUserLocation = YES;    //YES 为打开定位，NO为关闭定位</span><br></pre></td></tr></table></figure>
<h4 id="5-2-位置更新执行的回调函数"><a href="#5-2-位置更新执行的回调函数" class="headerlink" title="5.2 位置更新执行的回调函数"></a>5.2 位置更新执行的回调函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-(void)mapView:(MAMapView *)mapView didUpdateUserLocation:(MAUserLocation *)userLocation</span><br><span class="line">updatingLocation:(BOOL)updatingLocation</span><br><span class="line">&#123;</span><br><span class="line">    if(updatingLocation)</span><br><span class="line">    &#123;</span><br><span class="line">        //取出当前位置的坐标</span><br><span class="line">        NSLog(@&quot;latitude : %f,longitude: %f&quot;,userLocation.coordinate.latitude,userLocation.coordinate.longitude);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-3-设置定位图层"><a href="#5-3-设置定位图层" class="headerlink" title="5.3 设置定位图层"></a>5.3 设置定位图层</h4><p>定位图层有3种显示模式，分别为：</p>
<ul>
<li>MAUserTrackingModeNone：仅在地图上显示，不跟随用户位置。</li>
<li>MAUserTrackingModeFollow：跟随用户位置移动，并将定位点设置成地图中心点。</li>
<li>MAUserTrackingModeFollowWithHeading：跟随用户的位置和角度移动。  </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[_mapView setUserTrackingMode: MAUserTrackingModeFollow animated:YES]; //地图跟着位置移动</span><br></pre></td></tr></table></figure>
<h5 id="自定义图层"><a href="#自定义图层" class="headerlink" title="自定义图层"></a>自定义图层</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// 将 MAMapView 的属性设置为 YES</span><br><span class="line">_mapView.customizeUserLocationAccuracyCircleRepresentation = YES;     </span><br><span class="line">_mapView.userTrackingMode = MAUserTrackingModeFollow;</span><br><span class="line"></span><br><span class="line">// 自定义定位精度对应的MACircleView. </span><br><span class="line">- (MAOverlayRenderer *)mapView:(MAMapView *)mapView rendererForOverlay:(id &lt;MAOverlay&gt;)overlay</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    if (overlay == mapView.userLocationAccuracyCircle)</span><br><span class="line">    &#123;</span><br><span class="line">        MACircleRenderer *accuracyCircleRenderer = [[MACircleRenderer alloc] initWithCircle:overlay];</span><br><span class="line">         </span><br><span class="line">        accuracyCircleRenderer.lineWidth    = 2.f;</span><br><span class="line">        accuracyCircleRenderer.strokeColor  = [UIColor lightGrayColor];</span><br><span class="line">        accuracyCircleRenderer.fillColor    = [UIColor colorWithRed:1 green:0 blue:0 alpha:.3];</span><br><span class="line">         </span><br><span class="line">        return accuracyCircleRenderer;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 自定义userLocation对应的annotationView. </span><br><span class="line">- (MAAnnotationView *)mapView:(MAMapView *)mapView viewForAnnotation:(id &lt;MAAnnotation&gt;)annotation</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    if ([annotation isKindOfClass:[MAUserLocation class]])</span><br><span class="line">    &#123;</span><br><span class="line">        static NSString *userLocationStyleReuseIndetifier = @&quot;userLocationStyleReuseIndetifier&quot;;</span><br><span class="line">        MAAnnotationView *annotationView = [mapView dequeueReusableAnnotationViewWithIdentifier:userLocationStyleReuseIndetifier];</span><br><span class="line">        if (annotationView == nil)</span><br><span class="line">        &#123;</span><br><span class="line">            annotationView = [[MAAnnotationView alloc] initWithAnnotation:annotation</span><br><span class="line">                                                             reuseIdentifier:userLocationStyleReuseIndetifier];</span><br><span class="line">        &#125;</span><br><span class="line">        annotationView.image = [UIImage imageNamed:@&quot;userPosition&quot;];</span><br><span class="line">         </span><br><span class="line">        return annotationView;</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-4-后台定位"><a href="#5-4-后台定位" class="headerlink" title="5.4 后台定位"></a>5.4 后台定位</h4><ol>
<li>后台定位必须将info.plist的字段改成NSLocationAlwaysUsageDescription字段。</li>
<li>工程配置。开启 TARGETS-&gt;Capabilities-&gt;Background Modes</li>
</ol>
<p><img src="http://cache.amap.com/lbs/static/backgroundlocation.png" alt="Mou"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_mapView.pausesLocationUpdatesAutomatically = NO;</span><br><span class="line"> </span><br><span class="line">_mapView.allowsBackgroundLocationUpdates = YES;//iOS9以上系统必须配置</span><br></pre></td></tr></table></figure>
<h3 id="6-0-地图功能"><a href="#6-0-地图功能" class="headerlink" title="6.0 地图功能"></a>6.0 地图功能</h3><h4 id="6-1-卫星图"><a href="#6-1-卫星图" class="headerlink" title="6.1 卫星图"></a>6.1 卫星图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）普通地图 MAMapTypeStandard；</span><br><span class="line">2）卫星地图 MAMapTypeSatellite；</span><br><span class="line">3）夜间地图 MAMapTypeStandardNight；(3D矢量)</span><br><span class="line">//显示卫星地图</span><br><span class="line">_mapView.mapType = MAMapTypeSatellite;</span><br></pre></td></tr></table></figure>
<h4 id="6-2-实时交通"><a href="#6-2-实时交通" class="headerlink" title="6.2 实时交通"></a>6.2 实时交通</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_mapView.showTraffic= YES;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-标注-Annotation-大头针"><a href="#6-3-标注-Annotation-大头针" class="headerlink" title="6.3 标注 Annotation(大头针)"></a>6.3 标注 Annotation(大头针)</h4><h6 id="1-修改ViewController-m文件，在viewDidAppear方法中添加如下所示代码添加标注数据对象"><a href="#1-修改ViewController-m文件，在viewDidAppear方法中添加如下所示代码添加标注数据对象" class="headerlink" title="(1)修改ViewController.m文件，在viewDidAppear方法中添加如下所示代码添加标注数据对象"></a>(1)修改ViewController.m文件，在viewDidAppear方法中添加如下所示代码添加标注数据对象</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidAppear:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidAppear:animated];</span><br><span class="line"> 	// 创建标注对象</span><br><span class="line">    MAPointAnnotation *pointAnnotation = [[MAPointAnnotation alloc] init];</span><br><span class="line">    // 设置经纬度</span><br><span class="line">    pointAnnotation.coordinate = CLLocationCoordinate2DMake(39.989631, 116.481018);</span><br><span class="line">    // 设置标题</span><br><span class="line">    pointAnnotation.title = @&quot;方恒国际&quot;;</span><br><span class="line">    // 设置子标题</span><br><span class="line">    pointAnnotation.subtitle = @&quot;阜通东大街6号&quot;;</span><br><span class="line">    // 添加标注</span><br><span class="line">    [_mapView addAnnotation:pointAnnotation];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="2-实现MAMapViewDelegate-协议中的-mapView-viewForAnnotation-回调函数，设置标注样式"><a href="#2-实现MAMapViewDelegate-协议中的-mapView-viewForAnnotation-回调函数，设置标注样式" class="headerlink" title="(2)实现MAMapViewDelegate 协议中的 mapView:viewForAnnotation:回调函数，设置标注样式"></a>(2)实现MAMapViewDelegate 协议中的 mapView:viewForAnnotation:回调函数，设置标注样式</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (MAAnnotationView *)mapView:(MAMapView *)mapView viewForAnnotation:(id &lt;MAAnnotation&gt;)annotation</span><br><span class="line">&#123;</span><br><span class="line">    if ([annotation isKindOfClass:[MAPointAnnotation class]])</span><br><span class="line">    &#123;</span><br><span class="line">        static NSString *pointReuseIndentifier = @&quot;pointReuseIndentifier&quot;;</span><br><span class="line">        MAPinAnnotationView*annotationView = (MAPinAnnotationView*)[mapView dequeueReusableAnnotationViewWithIdentifier:pointReuseIndentifier];</span><br><span class="line">        if (annotationView == nil)</span><br><span class="line">        &#123;</span><br><span class="line">            annotationView = [[MAPinAnnotationView alloc] initWithAnnotation:annotation reuseIdentifier:pointReuseIndentifier];</span><br><span class="line">        &#125;</span><br><span class="line">        annotationView.canShowCallout= YES;       //设置气泡可以弹出，默认为NO</span><br><span class="line">        annotationView.animatesDrop = YES;        //设置标注动画显示，默认为NO</span><br><span class="line">        annotationView.draggable = YES;        //设置标注可以拖动，默认为NO</span><br><span class="line">        annotationView.pinColor = MAPinAnnotationColorPurple;</span><br><span class="line">        return annotationView;</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br></pre></td></tr></table></figure>
<h4 id="6-4-自定义标注"><a href="#6-4-自定义标注" class="headerlink" title="6.4 自定义标注"></a>6.4 自定义标注</h4><ol>
<li>添加标注数据对象，可参考大头针标注的步骤（6.3）。</li>
<li>导入标记图片文件到工程中。这里我们导入一个名为 restauant.png 的图片文件。</li>
<li>在 <mamapviewdelegate>协议的回调函数mapView:viewForAnnotation:中修改 MAAnnotationView 对应的标注图片。示例代码如下：</mamapviewdelegate></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (MAAnnotationView *)mapView:(MAMapView *)mapView viewForAnnotation:(id&lt;MAAnnotation&gt;)annotation</span><br><span class="line">&#123;</span><br><span class="line">    if ([annotation isKindOfClass:[MAPointAnnotation class]])</span><br><span class="line">    &#123;</span><br><span class="line">        static NSString *reuseIndetifier = @&quot;annotationReuseIndetifier&quot;;</span><br><span class="line">        MAAnnotationView *annotationView = (MAAnnotationView *)[mapView dequeueReusableAnnotationViewWithIdentifier:reuseIndetifier];</span><br><span class="line">        if (annotationView == nil)</span><br><span class="line">        &#123;</span><br><span class="line">            annotationView = [[MAAnnotationView alloc] initWithAnnotation:annotation</span><br><span class="line">reuseIdentifier:reuseIndetifier];</span><br><span class="line">        &#125;</span><br><span class="line">        annotationView.image = [UIImage imageNamed:@&quot;restaurant&quot;];</span><br><span class="line">        //设置中心点偏移，使得标注底部中间点成为经纬度对应点</span><br><span class="line">        annotationView.centerOffset = CGPointMake(0, -18);</span><br><span class="line">        return annotationView;</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h6><p><img src="http://cache.amap.com/lbs/static/restaurantannotation-e1417594095862.png" alt="Alex Czs"></p>
<h4 id="6-5-自定义气泡"><a href="#6-5-自定义气泡" class="headerlink" title="6.5 自定义气泡"></a>6.5 自定义气泡</h4><p><img src="http://cache.amap.com/lbs/static/callout.png" alt="Alex Czs"></p>
<p>(1) 新建自定义气泡类 CustomCalloutView，继承 UIView。<br>(2) 在 CustomCalloutView.h 中定义数据属性，包含：图片、商户名和商户地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@interface CustomCalloutView : UIView</span><br><span class="line"> </span><br><span class="line">@property (nonatomic, strong) UIImage *image; //商户图</span><br><span class="line">@property (nonatomic, copy) NSString *title; //商户名</span><br><span class="line">@property (nonatomic, copy) NSString *subtitle; //地址</span><br><span class="line"> </span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>(3) 在CustomCalloutView.m中重写UIView的drawRect方法，绘制弹出气泡的背景。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#define kArrorHeight        10</span><br><span class="line"> </span><br><span class="line">- (void)drawRect:(CGRect)rect</span><br><span class="line">&#123;</span><br><span class="line">     </span><br><span class="line">    [self drawInContext:UIGraphicsGetCurrentContext()];</span><br><span class="line">     </span><br><span class="line">    self.layer.shadowColor = [[UIColor blackColor] CGColor];</span><br><span class="line">    self.layer.shadowOpacity = 1.0;</span><br><span class="line">    self.layer.shadowOffset = CGSizeMake(0.0f, 0.0f);</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (void)drawInContext:(CGContextRef)context</span><br><span class="line">&#123;</span><br><span class="line">     </span><br><span class="line">    CGContextSetLineWidth(context, 2.0);</span><br><span class="line">    CGContextSetFillColorWithColor(context, [UIColor colorWithRed:0.3 green:0.3 blue:0.3 alpha:0.8].CGColor);</span><br><span class="line">     </span><br><span class="line">    [self getDrawPath:context];</span><br><span class="line">    CGContextFillPath(context);</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (void)getDrawPath:(CGContextRef)context</span><br><span class="line">&#123;</span><br><span class="line">    CGRect rrect = self.bounds;</span><br><span class="line">    CGFloat radius = 6.0;</span><br><span class="line">    CGFloat minx = CGRectGetMinX(rrect),</span><br><span class="line">    midx = CGRectGetMidX(rrect),</span><br><span class="line">    maxx = CGRectGetMaxX(rrect);</span><br><span class="line">    CGFloat miny = CGRectGetMinY(rrect),</span><br><span class="line">    maxy = CGRectGetMaxY(rrect)-kArrorHeight;</span><br><span class="line">     </span><br><span class="line">    CGContextMoveToPoint(context, midx+kArrorHeight, maxy);</span><br><span class="line">    CGContextAddLineToPoint(context,midx, maxy+kArrorHeight);</span><br><span class="line">    CGContextAddLineToPoint(context,midx-kArrorHeight, maxy);</span><br><span class="line">     </span><br><span class="line">    CGContextAddArcToPoint(context, minx, maxy, minx, miny, radius);</span><br><span class="line">    CGContextAddArcToPoint(context, minx, minx, maxx, miny, radius);</span><br><span class="line">    CGContextAddArcToPoint(context, maxx, miny, maxx, maxx, radius);</span><br><span class="line">    CGContextAddArcToPoint(context, maxx, maxy, midx, maxy, radius);</span><br><span class="line">    CGContextClosePath(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(4) 定义用于显示气泡内容的控件，并添加到SubView中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#define kPortraitMargin     5</span><br><span class="line">#define kPortraitWidth      70</span><br><span class="line">#define kPortraitHeight     50</span><br><span class="line"> </span><br><span class="line">#define kTitleWidth         120</span><br><span class="line">#define kTitleHeight        20</span><br><span class="line"> </span><br><span class="line">@interface CustomCalloutView ()</span><br><span class="line"> </span><br><span class="line">@property (nonatomic, strong) UIImageView *portraitView;</span><br><span class="line">@property (nonatomic, strong) UILabel *subtitleLabel;</span><br><span class="line">@property (nonatomic, strong) UILabel *titleLabel;</span><br><span class="line"> </span><br><span class="line">@end</span><br><span class="line"> </span><br><span class="line">@implementation CustomCalloutView</span><br><span class="line"> </span><br><span class="line">- (id)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        self.backgroundColor = [UIColor clearColor];</span><br><span class="line">        [self initSubViews];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (void)initSubViews</span><br><span class="line">&#123;</span><br><span class="line">    // 添加图片，即商户图</span><br><span class="line">    self.portraitView = [[UIImageView alloc] initWithFrame:CGRectMake(kPortraitMargin, kPortraitMargin, kPortraitWidth, kPortraitHeight)];</span><br><span class="line">     </span><br><span class="line">    self.portraitView.backgroundColor = [UIColor blackColor];</span><br><span class="line">    [self addSubview:self.portraitView];</span><br><span class="line">     </span><br><span class="line">    // 添加标题，即商户名</span><br><span class="line">    self.titleLabel = [[UILabel alloc] initWithFrame:CGRectMake(kPortraitMargin * 2 + kPortraitWidth, kPortraitMargin, kTitleWidth, kTitleHeight)];</span><br><span class="line">    self.titleLabel.font = [UIFont boldSystemFontOfSize:14];</span><br><span class="line">    self.titleLabel.textColor = [UIColor whiteColor];</span><br><span class="line">    self.titleLabel.text = @&quot;titletitletitletitle&quot;;</span><br><span class="line">    [self addSubview:self.titleLabel];</span><br><span class="line">     </span><br><span class="line">    // 添加副标题，即商户地址</span><br><span class="line">    self.subtitleLabel = [[UILabel alloc] initWithFrame:CGRectMake(kPortraitMargin * 2 + kPortraitWidth, kPortraitMargin * 2 + kTitleHeight, kTitleWidth, kTitleHeight)];</span><br><span class="line">    self.subtitleLabel.font = [UIFont systemFontOfSize:12];</span><br><span class="line">    self.subtitleLabel.textColor = [UIColor lightGrayColor];</span><br><span class="line">    self.subtitleLabel.text = @&quot;subtitleLabelsubtitleLabelsubtitleLabel&quot;;</span><br><span class="line">    [self addSubview:self.subtitleLabel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(5) 在CustomCalloutView.m中给控件传入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)setTitle:(NSString *)title</span><br><span class="line">&#123;</span><br><span class="line">    self.titleLabel.text = title;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (void)setSubtitle:(NSString *)subtitle</span><br><span class="line">&#123;</span><br><span class="line">    self.subtitleLabel.text = subtitle;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (void)setImage:(UIImage *)image</span><br><span class="line">&#123;</span><br><span class="line">    self.portraitView.image = image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="点击弹出自定义的气泡，还需要自定义AnnotationView"><a href="#点击弹出自定义的气泡，还需要自定义AnnotationView" class="headerlink" title="点击弹出自定义的气泡，还需要自定义AnnotationView"></a>点击弹出自定义的气泡，还需要自定义AnnotationView</h6><p>(1) 新建类CustomAnnotationView，继承MAAnnotationView或MAPinAnnotationView。若继承MAAnnotationView，则需要设置标注图标；若继承MAPinAnnotationView，使用默认的大头针标注。<br>(2) 在CustomAnnotationView.h中定义自定义气泡属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;CustomCalloutView.h&quot;</span><br><span class="line"> </span><br><span class="line">@interface CustomAnnotationView : MAAnnotationView</span><br><span class="line"> </span><br><span class="line">@property (nonatomic, readonly) CustomCalloutView *calloutView;</span><br><span class="line"> </span><br><span class="line">@end</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">(3) 在CustomAnnotationView.m中修改calloutView属性</span><br></pre></td></tr></table></figure>
<p>@interface CustomAnnotationView ()</p>
<p>@property (nonatomic, strong, readwrite) CustomCalloutView *calloutView;</p>
<p>@end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(4) 重写选中方法setSelected。选中时新建并添加calloutView，传入数据；非选中时删除calloutView(需要导入building.png图片)</span><br></pre></td></tr></table></figure></p>
<p>#define kCalloutWidth       200.0</p>
<p>#define kCalloutHeight      70.0</p>
<ul>
<li><p>(void)setSelected:(BOOL)selected animated:(BOOL)animated<br>{<br>  if (self.selected == selected)<br>  {</p>
<pre><code>return;
</code></pre><p>  }</p>
<p>  if (selected)<br>  {</p>
<pre><code>if (self.calloutView == nil)
{
    self.calloutView = [[CustomCalloutView alloc] initWithFrame:CGRectMake(0, 0, kCalloutWidth, kCalloutHeight)];
    self.calloutView.center = CGPointMake(CGRectGetWidth(self.bounds) / 2.f + self.calloutOffset.x,
                                          -CGRectGetHeight(self.calloutView.bounds) / 2.f + self.calloutOffset.y);
}

self.calloutView.image = [UIImage imageNamed:@&quot;building&quot;];
self.calloutView.title = self.annotation.title;
self.calloutView.subtitle = self.annotation.subtitle;

[self addSubview:self.calloutView];
</code></pre><p>  }<br>  else<br>  {</p>
<pre><code>[self.calloutView removeFromSuperview];
</code></pre><p>  }</p>
<p>  [super setSelected:selected animated:animated];<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(5) 修改ViewController.m，在MAMapViewDelegate的回调方法mapView:viewForAnnotation中的修改annotationView的类型</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>#import “CustomAnnotationView.h”</p>
<ul>
<li><p>(MAAnnotationView <em>)mapView:(MAMapView </em>)mapView viewForAnnotation:(id<maannotation>)annotation<br>{<br>  if ([annotation isKindOfClass:[MAPointAnnotation class]])<br>  {</maannotation></p>
<pre><code>static NSString *reuseIndetifier = @&quot;annotationReuseIndetifier&quot;;
CustomAnnotationView *annotationView = (CustomAnnotationView *)[mapView dequeueReusableAnnotationViewWithIdentifier:reuseIndetifier];
if (annotationView == nil)
{
    annotationView = [[CustomAnnotationView alloc] initWithAnnotation:annotation reuseIdentifier:reuseIndetifier];
}
annotationView.image = [UIImage imageNamed:@&quot;restaurant&quot;];

// 设置为NO，用以调用自定义的calloutView
annotationView.canShowCallout = NO;

// 设置中心点偏移，使得标注底部中间点成为经纬度对应点
annotationView.centerOffset = CGPointMake(0, -18);
return annotationView;
</code></pre><p>  }<br>  return nil;<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 效果图</span><br><span class="line">![AlexCzs](http://cache.amap.com/lbs/static/customannotation-e1417591437365.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 6.6 覆盖物 Overlay</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在地图上添加一个 Overlay 的步骤如下：</p>
<p>1）定义一个 overlay 对象；</p>
<p>2）定义一个 overlayView 对象；</p>
<p>3）实现 mapView:viewForOverlay: 代理方法；</p>
<p>4）使用 MAMapView 的 addOverlay:方法添加。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">详情:&lt;http://lbs.amap.com/api/ios-sdk/guide/mapkit/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 6.7 热力图图层</span><br></pre></td></tr></table></figure>
<p>在地图上添加热力图的步骤如下：</p>
<p>1.构造MAHeatMapTileOverlay 对象。</p>
<p>2.配置热力图图层的参数。</p>
<pre><code>a) data——数据数组，数组中是 MAHeatMapNode 对象（包含：点坐标和权重值）。

b) radius——半径，默认值为 12ps。

c) opacity——透明度，默认值为 0.6。

d) gradient——渐变色对象。
</code></pre><p>3.将MAHeatMapTileOverlay添加到MAMapView中。</p>
<p>4.实现MAMapViewDelegate的mapView:viewForOverlay:函数，在地图上显示热力图图层。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">###### 效果图</span><br><span class="line">![Alex Czs](http://cache.amap.com/lbs/static/heatmap.PNG)</span><br><span class="line"></span><br><span class="line">### 7.0 地图控件</span><br></pre></td></tr></table></figure></p>
<p>iOS SDK提供“地图Logo”、“指南针”和“比例尺”三种地图控件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 7.1 地图Logo</span><br><span class="line">高德地图Logo不能移除,但可以改变位置</span><br></pre></td></tr></table></figure></p>
<p>_mapView.logoCenter = CGPointMake(CGRectGetWidth(self.view.bounds)-55, 450);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* </span><br><span class="line">#### 7.2 指南针</span><br><span class="line">指南针默认是开启状态，显示在地图的右上角</span><br></pre></td></tr></table></figure>
<p>_mapView.showsCompass= YES; // 设置成NO表示关闭指南针；YES表示显示指南针</p>
<p>_mapView.compassOrigin= CGPointMake(_mapView.compassOrigin.x, 22); //设置指南针位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 7.3 比例尺</span><br><span class="line">比例尺表示地图上两点间距离与实际与之对应的两点距离的比</span><br></pre></td></tr></table></figure></p>
<p>_mapView.showScale= YES;  //设置成NO表示不显示比例尺；YES表示显示比例尺<br>_mapView.scaleOrigin= CGPointMake(_mapView.scaleOrigin.x, 22);  //设置比例尺位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 8.0 地图手势</span><br><span class="line">*  </span><br><span class="line">#### 缩放手势</span><br></pre></td></tr></table></figure></p>
<p>_mapView.zoomEnabled = NO;    //NO表示禁用缩放手势，YES表示开启<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 平移（滑动）手势</span><br></pre></td></tr></table></figure></p>
<p>_mapView.scrollEnabled = NO;    //NO表示禁用滑动手势，YES表示开启<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* </span><br><span class="line">#### 平移（滑动）手势</span><br><span class="line">用户可以用两个手指在地图上转动，可以旋转3D矢量地图。</span><br></pre></td></tr></table></figure></p>
<p>_mapView.rotateEnabled= NO;    //NO表示禁用旋转手势，YES表示开启<br>[_mapView setRotationDegree:60.f animated:YES duration:0.5];//旋转角度的范围是[0.f 360.f]，以逆时针为正向<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* </span><br><span class="line">#### 倾斜手势(3D)</span><br><span class="line">用户可以在地图上放置两个手指，移动它们一起向下或向上去增加或减小倾斜角。</span><br></pre></td></tr></table></figure></p>
<p>mapView.rotateCameraEnabled= NO;    //NO表示禁用倾斜手势，YES表示开启<br>[_mapView setCameraDegree:30.f animated:YES duration:0.5];//倾斜角度范围为[0.f, 45.f]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 8.0 地图截屏</span><br><span class="line">iOS SDK支持对选定的屏幕地图区域(CGRect)进行截屏，截取的内容包括：地图、地图覆盖物、弹出气泡。</span><br><span class="line"></span><br><span class="line">说明：地图截屏功能依赖于地图显示，即：只有内容先显示在地图上，才能进行截屏</span><br></pre></td></tr></table></figure></p>
<p><strong>block UIImage *screenshotImage = nil;
</strong>block NSInteger resState = 0;<br>[self.mapView takeSnapshotInRect:inRect withCompletionBlock:^(UIImage *resultImage, NSInteger state) {<br>        screenshotImage = resultImage;<br>        resState = state; // state表示地图此时是否完整，0-不完整，1-完整<br>}];<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">###### 效果图:state=0，地图不完整</span><br><span class="line">![Alex Czs](http://cache.amap.com/lbs/static/snapshot_state_268x433.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 9.0 离线地图(3D)</span><br><span class="line">###### 效果图</span><br><span class="line">![Alex Czs](http://lbs.amap.com/wp-content/uploads/2014/05/ios_pic10.png)</span><br><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 9.1 获取离线数据项</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>(void)setupCities<br>{<br>  self.sectionTitles = @[@”全国”, @”直辖市”, @”省份”];</p>
<p>  self.cities = [MAOfflineMap sharedOfflineMap].cities;//普通城市和直辖市<br>  self.provinces = [MAOfflineMap sharedOfflineMap].provinces;//省<br>  self.municipalities = [MAOfflineMap sharedOfflineMap].municipalities;//直辖市</p>
</li>
</ul>
<p>}</p>
<ul>
<li><p>(MAOfflineItem <em>)itemForIndexPath:(NSIndexPath </em>)indexPath<br>{<br>  MAOfflineItem *item = nil;<br>  switch (indexPath.section)<br>  {</p>
<pre><code>case 0:
{
    item = [MAOfflineMap sharedOfflineMap].nationWide;//全国概要图
    break;
}
case 1:
{
    item = self.municipalities[indexPath.row];//直辖市
    break;
}
case 2:
{
    item = nil;
    break;
}
default:
{
    MAOfflineProvince *pro = self.provinces[indexPath.section - self.sectionTitles.count];           
    if (indexPath.row == 0)
    {
        item = pro; //整个省
    }
    else
    {
        item = pro.cities[indexPath.row - 1]; //市
    }           
    break;
}
</code></pre><p>  }<br>  return item;<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* </span><br><span class="line">####  9.2 下载某个离线地图数据项</span><br></pre></td></tr></table></figure>
</li>
<li><p>(void)download:(MAOfflineItem *)item<br>{<br>  if (item == nil || item.itemStatus == MAOfflineItemStatusInstalled)<br>  {</p>
<pre><code>return;
</code></pre><p>  }</p>
<p>  NSLog(@”download :%@”, item.name);</p>
<p>  [[MAOfflineMap sharedOfflineMap] downloadItem:item shouldContinueWhenAppEntersBackground:YES downloadBlock:^(MAOfflineMapDownloadStatus downloadStatus, id info) {</p>
<pre><code>/* Manipulations to your application’s user interface must occur on the main thread. */
dispatch_async(dispatch_get_main_queue(), ^{

      if (downloadStatus == MAOfflineMapDownloadStatusWaiting) 
      { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;等待下载&quot;); 
      } 
      else if(downloadStatus == MAOfflineMapDownloadStatusStart) 
      { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;开始下载&quot;); 
      } 
      else if(downloadStatus == MAOfflineMapDownloadStatusProgress) 
      { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;正在下载&quot;); 
      } 
      else if(downloadStatus == MAOfflineMapDownloadStatusCancelled) { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;取消下载&quot;); 
      } 
      else if(downloadStatus == MAOfflineMapDownloadStatusCompleted) { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;下载完成&quot;); 
      } 
      else if(downloadStatus == MAOfflineMapDownloadStatusUnzip) { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;下载完成，正在解压缩&quot;); 
      } 
      else if(downloadStatus == MAOfflineMapDownloadStatusError) { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;下载错误&quot;); 
      } 
      else if(downloadStatus == MAOfflineMapDownloadStatusFinished) { 
        NSLog(@&quot;状态为: %@&quot;, @&quot;全部完成&quot;); 
        [self.mapView reloadMap];              //激活离线地图 
      } 
});
</code></pre><p>  }];<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 9.3 展厅离线数据下载</span><br></pre></td></tr></table></figure>
</li>
<li><p>(void)pause:(MAOfflineItem *)item<br>{<br>  NSLog(@”pause :%@”, item.name);</p>
<p>  [[MAOfflineMap sharedOfflineMap] pauseItem:item];<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 10.0 室内外一体化(3D)</span><br><span class="line">支持商场、火车站、机场等大型室内建筑  </span><br><span class="line">支持通过楼层控件进行自由切换室内对应楼层</span><br><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 10.1 开启室内一体化</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>_mapView.showsIndoorMap = YES;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* </span><br><span class="line">#### 10.2 获取室内楼层变化</span><br><span class="line">开启显示室内地图之后，可通过实现代理方法获取室内地图楼层变化</span><br></pre></td></tr></table></figure></p>
<p>/**</p>
<ul>
<li>室内地图信息发生变化的回调</li>
<li>@param mapView            地图View</li>
<li>@param indoorBuilding     室内地图信息<br>*/<ul>
<li>(void)mapview:(MAMapView <em>)mapView didIndoorBuildingValueChanged:(MAIndoorBuilding </em>)indoorBuilding<br>{<br>MAIndoorBuilding *indoorInfo = indoorBuilding;<br>NSLog(@”floorName = %@”,indoorBuilding.floorName);        //楼层名<br>NSLog(@”floor = %d”,indoorBuilding.floor);                //楼层数<br>NSLog(@”buildingName = %@”,indoorBuilding.buildingName);  //楼块名（中文名）<br>NSLog(@”poiID = %@”,indoorBuilding.poiID);                //楼块ID<br>NSLog(@”numberOfFloor = %d”,indoorBuilding.numberOfFloor);//楼层总数<br>}  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 效果图</span><br><span class="line">![Alex Czs](http://cache.amap.com/lbs/static/mapsdk_indoor10.png)</span><br><span class="line"></span><br><span class="line">### 11.0 地图搜索功能</span><br><span class="line">实现步骤</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>（1） 引入搜索头文件，如：#import <amapsearchkit amapsearchkit.h="">。</amapsearchkit></p>
<p>（2） 配置搜索服务Key，以确保搜索功能正常使用，[AMapSearchServices sharedServices].apiKey = @”用户Key”;。</p>
<p>（3） 定义主搜索对象 AMapSearchAPI ，并继承搜索协议<amapsearchdelegate>。</amapsearchdelegate></p>
<p>（4） 构造主搜索对象，并设置代理。</p>
<p>（5） 构造 Request 对象，配置搜索请求参数。</p>
<p>（6） 通过主搜索对象以 Request 对象为参数，发起搜索。</p>
<p>（7） 实现搜索协议中对应的回调函数，通过解析 Response 对象获取搜索结果。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 11.1 POI搜索</span><br></pre></td></tr></table></figure></p>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<pre><code>@interface ViewController ()&lt;AMapSearchDelegate&gt;
{
    AMapSearchAPI *_search;
}
@end

-(void)viewDidLoad 
  {   
    //配置用户Key
    [AMapSearchServices sharedServices].apiKey = @&quot;用户Key&quot;;

//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapPOIAroundSearchRequest对象，设置周边请求参数
AMapPOIAroundSearchRequest *request = [[AMapPOIAroundSearchRequest alloc] init];
request.location = [AMapGeoPoint locationWithLatitude:39.990459 longitude:116.481476];
request.keywords = @&quot;方恒&quot;;
// types属性表示限定搜索POI的类别，默认为：餐饮服务|商务住宅|生活服务
// POI的类型共分为20种大类别，分别为：
// 汽车服务|汽车销售|汽车维修|摩托车服务|餐饮服务|购物服务|生活服务|体育休闲服务|
// 医疗保健服务|住宿服务|风景名胜|商务住宅|政府机构及社会团体|科教文化服务|
// 交通设施服务|金融保险服务|公司企业|道路附属设施|地名地址信息|公共设施
request.types = @&quot;餐饮服务|生活服务&quot;;
request.sortrule = 0;
request.requireExtension = YES;

//发起周边搜索
[_search AMapPOIAroundSearch: request];
}
//实现POI搜索对应的回调函数
- (void)onPOISearchDone:(AMapPOISearchBaseRequest     *)request response:(AMapPOISearchResponse *)response
{
    if(response.pois.count == 0)
    {
        return;
    }

//通过 AMapPOISearchResponse 对象处理搜索结果
NSString *strCount = [NSString stringWithFormat:@&quot;count: %d&quot;,response.count];
NSString *strSuggestion = [NSString stringWithFormat:@&quot;Suggestion: %@&quot;, response.suggestion];
NSString *strPoi = @&quot;&quot;;
for (AMapPOI *p in response.pois) {
    strPoi = [NSString stringWithFormat:@&quot;%@\nPOI: %@&quot;, strPoi, p.description];
}
NSString *result = [NSString stringWithFormat:@&quot;%@ \n %@ \n %@&quot;, strCount, strSuggestion, strPoi];
NSLog(@&quot;Place: %@&quot;, result);
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 路径规划查询</span><br><span class="line">iOS SDK 提供驾车、步行和公交三种类型的路径规划方案</span><br></pre></td></tr></table></figure></p>
<p>驾车路径搜索：可设置途经点waypoints、避让区域avoidpolygons和避让道路avoidroad，同时，还提供“时间最短”、“费用最少”、“距离最短”等多达9种的驾车策略strategy</p>
<p>公交换乘查询: 搜索参数类为 AMapTransitRouteSearchRequest，提供“最经济”、“最少换乘”、“不乘地铁”等6种换乘策略strategy</p>
<p>步行路径搜索：搜索参数类为 AMapWalkingRouteSearchRequest。</p>
<p>无论哪种类型路径规划，origin（起点坐标）和destination（终点坐标）为必设参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>  {<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapDrivingRouteSearchRequest对象，设置驾车路径规划请求参数
AMapDrivingRouteSearchRequest *request = [[AMapDrivingRouteSearchRequest alloc] init];
request.origin = [AMapGeoPoint locationWithLatitude:39.994949 longitude:116.447265]; 
request.destination = [AMapGeoPoint locationWithLatitude:39.990459 longitude:116.481476];
request.strategy = 2;//距离优先
request.requireExtension = YES;

//发起路径搜索
[_search AMapDrivingRouteSearch: naviRequest];
</code></pre><p>}</p>
<p>//实现路径搜索的回调函数</p>
<ul>
<li><p>(void)onRouteSearchDone:(AMapRouteSearchBaseRequest <em>)request response:(AMapRouteSearchResponse </em>)response<br>{<br>  if(response.route == nil)<br>  {</p>
<pre><code>return;
</code></pre><p>  }</p>
<p>  //通过AMapNavigationSearchResponse对象处理搜索结果<br>  NSString *route = [NSString stringWithFormat:@”Navi: %@”, response.route];<br>  NSLog(@”%@”, route);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### 12.0 地理编码和反地理编码</span><br><span class="line">![Alex Czs](http://lbs.amap.com/wp-content/uploads/2014/12/geocoding.png)</span><br><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 12.1 地理编码(地名-&gt;经纬度)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>  {<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapGeocodeSearchRequest对象，address为必选项，city为可选项
AMapGeocodeSearchRequest *geo = [[AMapGeocodeSearchRequest alloc] init];
geo.address = @&quot;西单&quot;;

//发起正向地理编码
[_search AMapGeocodeSearch: geo];
</code></pre><p>}</p>
<p>//实现正向地理编码的回调函数</p>
<ul>
<li><p>(void)onGeocodeSearchDone:(AMapGeocodeSearchRequest <em>)request response:(AMapGeocodeSearchResponse </em>)response<br>{<br>  if(response.geocodes.count == 0)<br>  {</p>
<pre><code>return;
</code></pre><p>  }</p>
<p>  //通过AMapGeocodeSearchResponse对象处理搜索结果<br>  NSString <em>strCount = [NSString stringWithFormat:@”count: %d”, response.count];<br>NSString </em>strGeocodes = @””;<br>  for (AMapTip *p in response.geocodes) {</p>
<pre><code>strGeocodes = [NSString stringWithFormat:@&quot;%@\ngeocode: %@&quot;, strGeocodes, p.description];
</code></pre><p>  }<br>  NSString *result = [NSString stringWithFormat:@”%@ \n %@”, strCount, strGeocodes];<br>  NSLog(@”Geocode: %@”, result);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 12.2 反地理编码(经纬度-&gt;地名)</span><br><span class="line">注意：对于直辖市，response.regeocode.addressComponent对象的city属性值为空，province属性中是直辖市名称。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>{<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapReGeocodeSearchRequest对象
AMapReGeocodeSearchRequest *regeo = [[AMapReGeocodeSearchRequest alloc] init];
regeo.location = [AMapGeoPoint locationWithLatitude:39.990459     longitude:116.481476];
regeo.radius = 10000;
regeoRequest.requireExtension = YES;

//发起逆地理编码
[_search AMapReGoecodeSearch: regeo];
</code></pre><p>}</p>
<p>//实现逆地理编码的回调函数</p>
<ul>
<li>(void)onReGeocodeSearchDone:(AMapReGeocodeSearchRequest <em>)request response:(AMapReGeocodeSearchResponse </em>)response<br>{<br>  if(response.regeocode != nil)<br>  {<pre><code>//通过AMapReGeocodeSearchResponse对象处理搜索结果
NSString *result = [NSString stringWithFormat:@&quot;ReGeocode: %@&quot;, response.regeocode];
NSLog(@&quot;ReGeo: %@&quot;, result);
</code></pre>  }<br>}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 13.0 公交查询</span><br><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 13.1 公交站查询</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>  {<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapBusStopSearchRequest对象
AMapBusStopSearchRequest *stopRequest = [[AMapBusStopSearchRequest alloc] init];
stopRequest.keywords = @&quot;望京西&quot;;
stopRequest.city = @&quot;beijing&quot;;

//发起公交站查询
[_search AMapBusStopSearch: stopRequest];
</code></pre><p>}</p>
<p>//实现公交站查询的回调函数<br>-(void)onBusStopSearchDone:(AMapBusStopSearchRequest<em>)request response:(AMapBusStopSearchResponse </em>)response<br>{<br>    if(response.busstops.count == 0)<br>    {<br>        return;<br>    }</p>
<pre><code>//通过AMapBusStopSearchResponse对象处理搜索结果
NSString *strStop = @&quot;&quot;;
for (AMapBusStop *p in response.busstops) {
    strStop = [NSString stringWithFormat:@&quot;%@\nStop: %@&quot;, strStop, p.description];
}
NSString *result = [NSString stringWithFormat:@&quot;%@ \n %@ \n %@&quot;, strCount, strSuggestion, strStop];
NSLog(@&quot;Stop: %@&quot;, result);
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">* </span><br><span class="line">#### 13.1 公交线路查询</span><br></pre></td></tr></table></figure></p>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>  {<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapBusLineNameSearchRequest对象
AMapBusLineNameSearchRequest *lineRequest = [[AMapBusLineSearchRequest alloc] init];
lineRequest.keywords = @&quot;445&quot;;
lineRequest.city = @&quot;beijing&quot;;
lineRequest.requireExtension = YES;

//发起公交线路查询
[_search AMapBusLineNameSearch:lineRequest];
</code></pre><p>}</p>
<p>//实现公交线路查询的回调函数<br>-(void)onBusLineSearchDone:(AMapBusLineBaseSearchRequest<em>)request response:(AMapBusLineSearchResponse </em>)response<br>{<br>    if(response.buslines.count == 0)<br>    {<br>        return;<br>    }</p>
<pre><code>//通过AMapBusLineSearchResponse对象处理搜索结果
NSString *strLine = @&quot;&quot;;
for (AMapBusLine *p in response.buslines) {
    strLine = [NSString stringWithFormat:@&quot;%@\nLine: %@&quot;, strLine, p.description];
}
NSString *result = [NSString stringWithFormat:@&quot;%@ \n %@ \n %@&quot;, strCount, strSuggestion, strLine];
NSLog(@&quot;Line: %@&quot;, result);
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 输入提示搜索</span><br></pre></td></tr></table></figure></p>
<p>1）uid为空，location为空，该提示语为品牌词，可根据该品牌词进行POI关键词搜索。</p>
<p>2）uid不为空，location为空，为公交线路，根据uid进行公交线路查询。</p>
<p>3）uid不为空，location也不为空，是一个真实存在的POI，可直接显示在地图上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>  {<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapInputTipsSearchRequest对象，设置请求参数
AMapInputTipsSearchRequest *tipsRequest = [[AMapInputTipsSearchRequest alloc] init];
tipsRequest.keywords = @&quot;肯德基&quot;;
tipsRequest.city = @&quot;北京&quot;;

//发起输入提示搜索
[_search AMapInputTipsSearch: tipsRequest];
</code></pre><p>}</p>
<p>//实现输入提示的回调函数<br>-(void)onInputTipsSearchDone:(AMapInputTipsSearchRequest<em>)request response:(AMapInputTipsSearchResponse </em>)response<br>{<br>    if(response.tips.count == 0)<br>    {<br>        return;<br>    }</p>
<pre><code>//通过AMapInputTipsSearchResponse对象处理搜索结果
NSString *strCount = [NSString stringWithFormat:@&quot;count: %d&quot;, response.count];
NSString *strtips = @&quot;&quot;;
for (AMapTip *p in response.tips) {
    strtips = [NSString stringWithFormat:@&quot;%@\nTip: %@&quot;, strtips, p.description];
}
NSString *result = [NSString stringWithFormat:@&quot;%@ \n %@&quot;, strCount, strtips];
NSLog(@&quot;InputTips: %@&quot;, result);
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 效果图</span><br><span class="line">![Alex Czs](http://cache.amap.com/lbs/static/ios_inputs.PNG)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 14.0 行政区划搜索</span><br><span class="line">根据县（区）级行政区划名称查询其下级区划的详细信息，如：中心点坐标、边界等等。</span><br><span class="line"></span><br><span class="line">下面以查询“北京市”的边界为例，介绍如何进行操作，示例代码如下：</span><br></pre></td></tr></table></figure></p>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>{<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapDistrictSearchRequest对象，keywords为必选项
AMapDistrictSearchRequest *districtRequest = [[AMapDistrictSearchRequest alloc] init];
districtRequest.keywords = @&quot;北京市直辖市&quot;;
districtRequest.requireExtension = YES;

//发起行政区划查询
[_search AMapDistrictSearch:districtRequest];
</code></pre><p>}</p>
<p>//实现行政区划查询的回调函数</p>
<ul>
<li>(void)onDistrictSearchDone:(AMapDistrictSearchRequest <em>)request response:(AMapDistrictSearchResponse </em>)response<br>{<br>  NSLog(@”response: %@”, response);<br>  [self handleDistrictResponse:response];<br>}</li>
<li><p>(void)handleDistrictResponse:(AMapDistrictSearchResponse *)response<br>{<br>  if (response == nil)<br>  {</p>
<pre><code>return;
</code></pre><p>  }<br>  //通过AMapDistrictSearchResponse对象处理搜索结果<br>  for (AMapDistrict *dist in response.districts)<br>  {</p>
<pre><code>MAPointAnnotation *poiAnnotation = [[MAPointAnnotation alloc] init];

poiAnnotation.coordinate = CLLocationCoordinate2DMake(dist.center.latitude, dist.center.longitude);
poiAnnotation.title      = dist.name;
poiAnnotation.subtitle   = dist.adcode;

[_mapView addAnnotation:poiAnnotation];

if (dist.polylines.count &gt; 0)
{
    MAMapRect bounds = MAMapRectZero;

    for (NSString *polylineStr in dist.polylines)
    {
        MAPolyline *polyline = [CommonUtility polylineForCoordinateString:polylineStr];
        [_mapView addOverlay:polyline];

        bounds = MAMapRectUnion(bounds, polyline.boundingMapRect);
    }

    [_mapView setVisibleMapRect:bounds animated:YES];
}
</code></pre><p>  }<br>}</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 效果图</span><br><span class="line">![Alex Czs](http://lbs.amap.com/wp-content/uploads/2014/12/IMG_0409-e1418977717227.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 15.0 天气查询</span><br></pre></td></tr></table></figure>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>{<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapWeatherSearchRequest对象，配置查询参数
AMapWeatherSearchRequest *request = [[AMapWeatherSearchRequest alloc] init];
request.city = @&quot;北京市直辖区&quot;;
request.type = AMapWeatherTypeLive; //AMapWeatherTypeLive为实时天气；AMapWeatherTypeForecase为预报天气

//发起行政区划查询
[_search AMapWeatherSearch:request];
</code></pre><p>}</p>
<p>//实现天气查询的回调函数</p>
<ul>
<li>(void)onWeatherSearchDone:(AMapWeatherSearchRequest <em>)request response:(AMapWeatherSearchResponse </em>)response<br>{<br>  //如果是实时天气<br>  if(request.type == AMapWeatherTypeLive)<br>  {<pre><code>if(response.lives.count == 0)
{
    return;
}
for (AMapLocalWeatherLive *live in response.lives) {
    ……
}
</code></pre>  }<br>  //如果是预报天气<br>  else<br>  {<pre><code>if(response.forecasts.count == 0)
{
    return;
}
for (AMapLocalWeatherForecast *forecast in response.forecasts) {
    ……
}
</code></pre>  }<br>}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 效果图</span><br><span class="line">![Alex Czs](http://cache.amap.com/lbs/static/ios_weathersearch.PNG)</span><br><span class="line"></span><br><span class="line">### 16.0 短串分享</span><br><span class="line">短串分享是指将用户的一些列信息加工转换得到短链接之后，通过短信、邮箱、微博、钉钉等分享给好友，从而调起高德地图APP或移动浏览器版高德地图进行展示。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>位置分享。例如：在您定位成功后，将当前的位置通过短信分享给好友，好友点击短信中的短串（如：<a href="http://f.amap.com/0CBOCW）后，调起高德地图App或手机浏览器看到你的位置，从而找到你。" target="_blank" rel="external">http://f.amap.com/0CBOCW）后，调起高德地图App或手机浏览器看到你的位置，从而找到你。</a></p>
<p>POI分享。例如：和好友相约去”金逸国际电影城(中关村店)”看电影，您通过POI搜索找到该地点后，通过微信分享给好友，好友点击微信中的端串（如：<a href="http://f.amap.com/059N4p）后，调起高德地图App或手机浏览器看到金逸国际电影城(中关村店)的位置，如约而至。" target="_blank" rel="external">http://f.amap.com/059N4p）后，调起高德地图App或手机浏览器看到金逸国际电影城(中关村店)的位置，如约而至。</a></p>
<p>路径分享。例如：你有一条绝好的上下班行车路线（不堵车），通过钉钉分享给你的同事，同事通过钉钉点开该路线的短串（<a href="http://f.amap.com/0FALy4）之后，也能开心的开车上下班了。" target="_blank" rel="external">http://f.amap.com/0FALy4）之后，也能开心的开车上下班了。</a></p>
<p>导航分享。导航功能是路径规划功能最直接的显示方式，通过点击短串直接进到导航界面，指导便捷出行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>{<br>    //配置用户Key<br>    [AMapSearchServices sharedServices].apiKey = @”用户Key”;</p>
<pre><code>//初始化检索对象 
_search = [[AMapSearchAPI alloc] init];
_search.delegate = self;

//构造AMapPOIShareSearchRequest对象
AMapPOIShareSearchRequest *request = [[AMapPOIShareSearchRequest alloc] init];
request.uid = @&quot;B000A7ZQYC&quot;;
request.location = [AMapGeoPoint locationWithLatitude:39.978416 longitude:116.314458];
request.name = @&quot;金逸国际电影城(中关村店)&quot;;
request.address = @&quot;中关村大街19号B1层B180&quot;;

//发起POI分享查询
[_search AMapPOIShareSearch:request];
</code></pre><p>}</p>
<p>//实现短串分享回调函数</p>
<ul>
<li>(void)onShareSearchDone:(AMapShareSearchBaseRequest <em>)request response:(AMapShareSearchResponse </em>)response<br>{<br>  NSLog(@”share response: shareURL = %@”, response.shareURL);<br>} <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">###### 效果图</span><br><span class="line">![Alex Czs](http://lbs.amap.com/wp-content/uploads/2014/12/IMG_0404-e1418974841368.png)</span><br><span class="line"></span><br><span class="line">###### 搜索语言代码</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>#import <amapsearchkit amapsearchkit.h=""></amapsearchkit></p>
<p>@interface ViewController ()<amapsearchdelegate><br>{<br>    AMapSearchAPI *_search;<br>}<br>@end</amapsearchdelegate></p>
<p>-(void)viewDidLoad<br>  {<br>    //初始化检索对象<br>    _search = [[AMapSearchAPI alloc] initWithSearchKey:@”您的key” Delegate:self];<br>    _search.language = AMapSearchLanguage_en;</p>
<pre><code>……
</code></pre><p>}<br>```</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/11/10/谓词/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          谓词
        
      </div>
    </a>
  
  
    <a href="/2015/06/07/XMPP/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">关于XMPP的一些问题</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="高德地图的集成" data-title="集成高德地图" data-url="http://yoursite.com/2015/09/12/高德地图的集成/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 AlexCzs
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>